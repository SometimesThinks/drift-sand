# drift-sand 기능 명세 (v1)

기준 문서: [docs/plan.md](docs/plan.md)

---

## 1. 문서 목적

본 문서는 v1 범위에 포함된 기능이 **어떤 조건에서 어떻게 동작하는지**를 정의한다. 구현·테스트·QA 시 판단 기준으로 사용한다.

---

## 2. 시간 설정

### 2.1 입력 수단

|        수단        | 설명                                                                       |
| :----------------: | -------------------------------------------------------------------------- |
| **시간 휠 피커** | **시/분/초 3개로 분리된 휠 피커**. 각 피커에서 해당 단위를 개별 선택. |

- 표시 단위: 설정/대기 화면에서는 시·분·초로 표시. 내부 계산은 초 단위(정수) 권장.

### 2.2 유효 범위

| 항목     | 값                                         |
| -------- | ------------------------------------------ |
| **최소** | 0초 (0:00:00)                              |
| **최대** | 24시간 (24:00:00 = 86,400초). 의도된 범위. |

- 휠 피커 범위: **시 0–24**, **분 0–59**, **초 0–59**.

### 2.3 입력 검증·오류 처리

- **유효 범위 밖 입력**: 휠 피커 입력이 범위를 벗어나는 경우 → **유효 구간으로 클램프** 후 적용.
- **0초로 설정 후 시작**: **시작 버튼 비활성화**.
- **24:00:00 경계 처리**: `24:00:00` 상태에서 분/초 값을 올릴 경우, **시를 24 → 23으로 강제 변경**하고 분/초는 사용자가 변경한 값으로 적용. 이때 **변경 중임을 빨간색으로 1회 표시**.
  - 예시: `24:00:00`에서 분 +1 → `23:01:00`
  - 예시: `24:00:00`에서 초 +1 → `23:00:01`
- **24시간 초과 조합**: 시/분/초 휠 피커 조합으로 전체 시간이 24시간(86,400초)을 초과하면 **24:00:00으로 클램프** 후 적용. 단, `24:00:00`에서 분/초를 올리는 경우는 위의 **24:00:00 경계 처리**를 우선 적용.

---

## 3. 타이머 제어 (시작 / 일시정지 / 리셋)

### 3.1 상태 정의

| 상태                 | 설명                                      |
| -------------------- | ----------------------------------------- |
| **대기(idle)**       | 시간만 설정된 상태. 시작 전.              |
| **실행 중(running)** | 타이머가 감소 중.                         |
| **일시정지(paused)** | 사용자가 일시정지한 상태. 남은 시간 고정. |
| **완료(finished)**   | 남은 시간이 0이 되어 종료된 상태.         |

### 3.2 전이 규칙

- **대기 → 실행 중**: 사용자가 `시작` 버튼 선택 시. 설정된 시간(초)이 남은 시간으로 설정되고 카운트다운 시작.
- **실행 중 → 일시정지**: 사용자가 `일시정지` 선택 시. 남은 시간 유지.
- **일시정지 → 실행 중**: 사용자가 `재개` 선택 시. 남은 시간부터 다시 카운트다운.
- **실행 중 / 일시정지 → 대기**: 사용자가 `리셋` 선택 시. 남은 시간 폐기, 설정 화면으로 복귀(또는 동일 화면에서 초기 설정값으로 복귀).
- **실행 중 → 완료**: 남은 시간이 0이 된 시점. 종료 알림 재생 후 완료 화면으로 전환.
- **완료 → 대기**: `리셋` 선택 시. 설정 화면으로 복귀.
- **완료 → 실행 중**: `재시작` 선택 시. **직전에 사용한 시간**(방금 끝난 세션의 설정 시간)으로 다시 카운트다운 시작.

### 3.3 버튼 노출

- **설정/대기 화면**: `시작`만 노출.
- **실행 화면**: `일시정지`, `리셋` 노출. 일시정지 상태일 때는 `재개`, `리셋`.
- **완료 화면**: `재시작`, `리셋`.

---

## 4. 모래시계 시각화

### 4.1 동작 원칙

- **진행률과 시각 매핑**: 남은 시간이 줄어들수록 위쪽 모래가 줄고 아래쪽 모래가 늘어나는 형태. `진행률 = (설정 시간 - 남은 시간) / 설정 시간` (0 ~ 1). 이 비율에 따라 아래쪽 모래 높이(또는 위쪽 감소량)를 연동.
- **실시간 갱신**: 실행 중에는 1초 단위(또는 더 촘촘한 간격)로 진행률을 반영해 시각이 부드럽게 변하도록 한다.
- **일시정지 시**: 해당 시점의 진행률에서 **애니메이션 정지**. 모래 흐름만 멈추고, 재개 시 이어서 흐름 재개.

### 4.2 예외

- 설정 시간이 0초인 경우: 모래시계는 존재하나 안에 모래가 없음. 시작 버튼은 비활성화되어 클릭 불가.
- 매우 긴 시간(예: 24시간) 실행 시: 배터리·성능 고려해 갱신 주기는 구현 시 결정(예: 1초 단위 유지).

---

## 5. 종료 알림

### 5.1 트리거

- **조건**: 타이머 상태가 **실행 중**에서 **남은 시간 = 0**이 되는 시점(또는 0이 되었음을 감지한 첫 틱).
- **동작**: 소리 재생 + 진동(플랫폼 지원 시). 이어서 **완료 화면**으로 전환.

### 5.2 소리·진동

- **소리**: 플랫폼 기본 알림음 또는 앱에서 지정한 짧은 알림음. 볼륨은 미디어/알림 설정 따름.
- **진동**: 1회 짧은 진동 패턴. (Android: Vibrator, iOS: 정책·권한 확인 후 구현.)
- **앱이 백그라운드일 때**: 종료 시점에 앱이 백그라운드여도 **알림(소리·진동)은 재생**. 필요 시 포그라운드로 올리거나 시스템 알림(노티피케이션)으로 "타이머 종료" 안내 검토.

### 5.3 권한·설정

- **알림 권한 없음**: 권한이 거부된 경우 소리/진동이 재생되지 않을 수 있음. 가능하면 권한 요청 시 "타이머 종료 시 알림을 위해 필요합니다" 등 목적 안내.
- **무음/방해 금지 모드**: OS 무음 모드에서는 진동만 하거나, 플랫폼 정책에 맞게 동작. (상세는 구현·플랫폼별 테스트에서 확정.)

---

## 6. 백그라운드 동작

### 6.1 요구 사항

- **앱이 백그라운드로 가도 타이머는 계속 동작**해야 함. (홈으로 나가기, 다른 앱 전환 등.)
- **포그라운드 복귀 시**: 현재 상태(실행 중/일시정지)와 **남은 시간**이 그대로 유지되어야 함. 화면에 표시되는 남은 시간·모래시계 시각도 복귀 시점에 맞게 즉시 갱신.

### 6.2 프로세스 종료(OS에 의한 kill) 후

- **앱이 OS에 의해 메모리에서 제거된 경우**: 재실행 시 **이전 타이머 세션을 복원할 의무는 v1에서 없음**.
  즉, 앱 재실행 시에는 대기 상태(설정 화면)부터 시작해도 됨.
  향후 "마지막 세션 복원" 기능을 넣을 경우 별도 스펙으로 정의.

### 6.3 기기 절전·화면 꺼짐

- 화면이 꺼져 있어도 **백그라운드에서 경과 시간 계산**은 유지. (플랫폼별 백그라운드 제한 내에서 구현.)

---

## 7. 화면별 동작 요약

| 화면          | 진입 조건                                | 주요 동작                                                             |
| ------------- | ---------------------------------------- | --------------------------------------------------------------------- |
| **설정/대기** | 앱 최초 실행, 리셋 후, 완료 후 리셋 선택 | 휠 피커로 시간 설정,`시작` → 실행 화면                               |
| **실행**      | 시작 버튼 선택 후                        | 모래시계·남은 시간 표시, 일시정지/재개/리셋. 남은 시간 0 → 완료 화면  |
| **완료**      | 타이머 남은 시간 0 도달 후               | 종료 알림 재생,`재시작` → 동일 시간으로 실행 화면, `리셋` → 설정/대기 |

---

## 8. 예외·엣지 케이스

| 상황                                            | 기대 동작                                                                 |
| ----------------------------------------------- | ------------------------------------------------------------------------- |
| 설정 시간 0초                                   | 2.3에 따라 시작 버튼 비활성화. 시작 불가.                                 |
| 매우 짧은 시간(1초) 설정                        | 1초 후 정상 종료·알림·완료 화면 전환.                                     |
| 일시정지 상태에서 앱 백그라운드 후 긴 시간 경과 | 복귀 시 여전히 일시정지 상태, 남은 시간 유지.                             |
| 실행 중 시스템 시계 변경(일광 절약 등)          | 가능하면 앱 내부 경과 시간 기준으로만 계산해 영향 최소화. (구현 시 결정.) |
| 알림 권한 거부 후 타이머 종료                   | 소리/진동은 재생되지 않을 수 있음. 완료 화면은 표시.                      |

---

## 9. v1에서 다루지 않는 것

- 프리셋 저장·불러오기
- 공유·소셜 기능
- 사용 통계·히스토리
- 앱 프로세스 종료 후 세션 복원
- 웹 배포

이후 버전에서 추가 시 별도 스펙으로 정의.
